---
# -------------------------------------------------------------
# AVD Single DC L3LS Data Center Topology
# -------------------------------------------------------------

name: single-dc-l3
prefix: ""

mgmt:
  network: mgmt
  ipv4_subnet: 192.168.1.0/24

topology:

  kinds:
    ceos:
      image: ceos:4.28.1F
    linux:
      image: mitchv85/ohv-host

  nodes:

###########################################
# Graphite Node                           #
# Provides Topology Graphing and the     #
# ability to connect to nodes in the      #
# topology via a web/ssh session          #
###########################################

    graphite:
      kind: linux
      image: netreplica/graphite
      mgmt_ipv4: 192.168.1.126
      env:
        GRAPHITE_DEFAULT_TYPE: clab
        GRAPHITE_DEFAULT_TOPO: AVD Single DC L3LS
        # CLAB_SSH_CONNECTION: ${SSH_CONNECTION}
      binds:
        # - .:/var/www/localhost/htdocs/clab   <----  This is the old path in docker image netreplica/graphite:webssh2
        - .:/htdocs/clab    # New path required for latest version
      ports:
        - 80:80
      exec:
        # - sh -c 'generate_offline_graph.sh'   # used to generate offline graphs
        - sh -c 'graphite_motd.sh 80'
      labels:
        graph-hide: yes

#########################
# DC 1 Spines           #
#########################

    DC1-SPINE1:
      kind: ceos
      mgmt_ipv4: 172.16.1.11
      startup-config: ./configs/DC1-SPINE1.cfg
      binds:
        - ./configs/spine-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      ports:
        - '22001:22'
        - '8001:80'
        - '44301:443'
      labels:
        graph-level: 2
        graph-icon: switch

    DC1-SPINE2:
      kind: ceos
      mgmt_ipv4: 172.16.1.12
      startup-config: ./configs/DC1-SPINE2.cfg
      binds:
        - ./configs/spine-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      ports:
        - '22002:22'
        - '8002:80'
        - '44302:443'
      labels:
        graph-level: 2
        graph-icon: switch


#########################
# DC1 Leaves            #
#########################

    DC1-LEAF1A:
      kind: ceos
      mgmt_ipv4: 172.16.1.101
      startup-config: ./configs/DC1-LEAF1A.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      ports:
        - '22005:22'
        - '8005:80'
        - '44305:443'
      labels:
        graph-level: 3
        graph-icon: switch

    DC1-LEAF1B:
      kind: ceos
      mgmt_ipv4: 172.16.1.102
      startup-config: ./configs/DC1-LEAF1B.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      ports:
        - '22006:22'
        - '8006:80'
        - '44306:443'
      labels:
        graph-level: 3
        graph-icon: switch

    DC1-LEAF2A:
      kind: ceos
      mgmt_ipv4: 172.16.1.103
      startup-config: ./configs/DC1-LEAF2A.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      ports:
        - '22007:22'
        - '8007:80'
        - '44307:443'
      labels:
        graph-level: 3
        graph-icon: switch

    DC1-LEAF2B:
      kind: ceos
      mgmt_ipv4: 172.16.1.104
      startup-config: ./configs/DC1-LEAF2B.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      ports:
        - '22008:22'
        - '8008:80'
        - '44308:443'
      labels:
        graph-level: 3
        graph-icon: switch

    DC1-LEAF1C:
      kind: ceos
      mgmt_ipv4: 172.16.1.151
      startup-config: ./configs/DC1-LEAF1C.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      ports:
        - '22009:22'
        - '8009:80'
        - '44309:443'
      labels:
        graph-level: 3
        graph-icon: switch

    DC1-LEAF2C:
      kind: ceos
      mgmt_ipv4: 172.16.1.152
      startup-config: ./configs/DC1-LEAF3A.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      ports:
        - '22010:22'
        - '8010:80'
        - '44310:443'
      labels:
        graph-level: 3
        graph-icon: switch
  
###########################################
# DC1 HOSTs                        #
###########################################

    DC1-HOST1:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 172.16.1.111
      ports:
        - '22017:22'
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -b -i 10.50.50.101/24 -g 10.50.50.1
      labels:
        graph-level: 4
        graph-icon: host

    DC1-HOST2:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 172.16.1.112
      ports:
        - '22018:22'
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -b -i 10.60.60.101/24 -g 10.60.60.1
      labels:
        graph-level: 4
        graph-icon: host

    DC1-HOST3:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 172.16.1.113
      ports:
        - '22019:22'
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -b -i 10.50.50.102/24 -g 10.50.50.1
      labels:
        graph-level: 4
        graph-icon: host

    DC1-HOST4:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 172.16.1.114
      ports:
        - '22020:22'
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -b -i 10.60.60.102/24 -g 10.60.60.1
      labels:
        graph-level: 4
        graph-icon: host

########################
# SPINE1 to LEAF       #
########################
    - endpoints: ["DC1-SPINE1:eth1", "DC1-LEAF1A:eth1"]
    - endpoints: ["DC1-SPINE1:eth2", "DC1-LEAF1B:eth1"]
    - endpoints: ["DC1-SPINE1:eth3", "DC1-LEAF2A:eth1"]
    - endpoints: ["DC1-SPINE1:eth4", "DC1-LEAF2B:eth1"]

########################
# SPINE2 to LEAF       #
########################
    - endpoints: ["DC1-SPINE2:eth1", "DC1-LEAF1A:eth2"]
    - endpoints: ["DC1-SPINE2:eth2", "DC1-LEAF1B:eth2"]
    - endpoints: ["DC1-SPINE2:eth3", "DC1-LEAF2A:eth2"]
    - endpoints: ["DC1-SPINE2:eth4", "DC1-LEAF2B:eth2"]



####################
# LEAF Peer-links  #
####################
    - endpoints: ["DC1-LEAF1A:eth3", "DC1-LEAF1B:eth3"]
    - endpoints: ["DC1-LEAF1A:eth4", "DC1-LEAF1B:eth4"]
    - endpoints: ["DC1-LEAF2A:eth3", "DC1-LEAF2B:eth3"]
    - endpoints: ["DC1-LEAF2A:eth4", "DC1-LEAF2B:eth4"]
    - endpoints: ["DC1-LEAF1A:eth8", "DC1-LEAF1C:eth1"]
    - endpoints: ["DC1-LEAF1B:eth8", "DC1-LEAF1C:eth2"]

####################
# Hosts            #
####################
    - endpoints: ["DC1-HOST1:eth1", "DC1-LEAF1A:eth5"]
    - endpoints: ["DC1-HOST1:eth2", "DC1-LEAF1B:eth5"]
    - endpoints: ["DC1-HOST2:eth1", "DC1-LEAF1A:eth6"]
    - endpoints: ["DC1-HOST2:eth2", "DC1-LEAF1B:eth6"]
    - endpoints: ["DC1-HOST3:eth1", "DC1-LEAF2A:eth5"]
    - endpoints: ["DC1-HOST3:eth2", "DC1-LEAF2B:eth5"]
    - endpoints: ["DC1-HOST4:eth1", "DC1-LEAF2A:eth6"]
    - endpoints: ["DC1-HOST4:eth2", "DC1-LEAF2B:eth6"]
